@page "/notes"
@using TechNotes.Domain.Abstractions
@attribute [StreamRendering]
@inject ISender Sender;
<PageTitle>Notes</PageTitle>
<h3>Notes</h3>
<a href="/note-editor" class="btn btn-primary">Create New Note</a>
@if (notes == null)
{
    <p>Loading notes...</p>
}
else if (notes.Count == 0)
{
    <p>No notes available.</p>
}
else
{
    <ul>
        @foreach (NoteResponse note in notes)
        {
            <li>
                <strong>@note.Title</strong> - Created at: @note.CreatedAt.ToString("g")
                <p>@note.Content</p>
                @if (note.IsPublished)
                {
                    <span> (Published at: @note.PublishedAt?.ToString("g"))</span>
                }
                <a href="/note-editor/@note.Id">Edit</a>
            </li>
        }
    </ul>
}

@code {
    private List<NoteResponse>? notes = new List<NoteResponse>();
    protected override async Task OnInitializedAsync()
    {
        Result<List<NoteResponse>>? result = await Sender.Send(new GetNotesQuery());
        if (result != null)
        {

            notes = result.IsSuccessful ? result : new List<NoteResponse>();
        }
    }
}